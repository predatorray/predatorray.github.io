<!DOCTYPE html>
<html>
  <head>
    <!-- meta information -->
<meta charset="utf-8">
<meta name="description" 
      content="原文地址：[Mockito in six easy examples][1]原文作者：[Gojko Adzic][2][Mockito][3]是个奇妙的Java模拟对象（mock）类库。与其他Java或是.NET模拟对象类库相比，我被..." >
<meta name="author" content="Ray">

<!-- Enable responsiveness on mobile devices-->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

<!-- title -->
<title>Mockito六个简单示例 &middot; Ray's Blog</title>

<!-- icons -->
<link rel="shortcut icon" href="/public/images/favicon.ico" />

<!-- stylesheets -->
<link rel="stylesheet" href="/public/css/responsive.gs.12col.css">
<link rel="stylesheet" href="/public/css/animate.min.css">
<link rel="stylesheet" href="/public/css/main.css">
<link rel="stylesheet" href="/public/css/prettify.css">

<!-- Google fonts -->
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,400italic&subset=latin-ext">



<!-- feed links -->
<link rel="alternate" href="/feed.xml" type="application/rss+xml" title="">

  </head>
  <body>
    <div class="container azul">
      <header class="top row gutters">
        <div class="col span_2 center">
          <!-- TODO: add baseurl to the logo link -->
          <a href="" id="logo" title="Ray's Blog"
             style="background-image: url(/public/images/logo.png);"></a>
        </div>
        <nav class="col span_10 top-navbar">
  
  <a href="/" title="主页"
     >主页</a>
  
  <a href="/about" title="关于我"
     >关于我</a>
  
</nav>

      </header>

      <article class="single row gutters">
  <time class="published" datetime="2013-12-01">01 December 2013</time>
  <h2>Mockito六个简单示例</h2>

  <p>原文地址：<a href="http://gojko.net/2009/10/23/mockito-in-six-easy-examples/">Mockito in six easy examples</a></p>

<p>原文作者：<a href="http://gojko.net/author/admin/">Gojko Adzic</a></p>

<p><a href="http://mockito.org/">Mockito</a>是个奇妙的Java模拟对象（mock）类库。与其他Java或是.NET模拟对象类库相比，我被它简单、易用的特性所吸引。接下来我会列举六个十分简单的例子来帮助你了解Mockit。</p>

<p>首先，前往<a href="http://mockito.org/">主页</a>下载mockito，把<code>org.mockito.Mockito</code>类<code>import</code>（或者使用<code>static import</code>，下文都使用这种方式）进你的代码中，然后开始感受它的奇妙之处吧。</p>

<p>使用<code>mock(class)</code>来创建一个桩（stub）或者一个模拟对象（译者注：关于桩与模拟的区别可以参考Martin Fowler的文章<a href="http://martinfowler.com/articles/mocksArentStubs.html">Mocks Aren&#39;t Stubs</a>）。然后，使用<code>when(mock).thenReturn(value)</code>来指定这个桩返回的值。如果你指定了不止一个值，这个桩将会顺序返回这些值，直到最后一个将会不变（所以指定一次返回值，这个方法的返回就不会变了）。例如，</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">import static org.mockito.Mockito.*;
import static org.junit.Assert.*;
import java.util.Iterator;
import org.junit.Test;
....
    @Test
    public void iterator_will_return_hello_world(){
        //arrange
        Iterator i=mock(Iterator.class);
        when(i.next()).thenReturn(&quot;Hello&quot;).thenReturn(&quot;World&quot;);
        //act
        String result=i.next()+&quot; &quot;+i.next();
        //assert
        assertEquals(&quot;Hello World&quot;, result);
    }
</code></pre></div>
<p>在这个例子中，我们创建了一个模拟的迭代器，第一次调用<code>next()</code>时返回<code>&quot;Hello&quot;</code>，第二次返回<code>&quot;World&quot;</code>。接着我们做一个普通的断言（Assertion）。</p>

<p>桩当然也可以根据对方法传递的不同参数返回不同的值。例如，</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">    @Test
    public void with_arguments(){
        Comparable c=mock(Comparable.class);
        when(c.compareTo(&quot;Test&quot;)).thenReturn(1);
        assertEquals(1,c.compareTo(&quot;Test&quot;));
    }
</code></pre></div>
<p>在上面的例子里，我们创建了一个<code>Comparable</code>的桩对象，当它和一个特定的值进行比较时（这里是<code>&quot;Test&quot;</code>）返回1。如果你并不能预测到这个方法将会传递的参数，或者你更不关心参数是什么，可以使用<code>anyInt()</code>（当然还有其他类型的替代）。举个例子，</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">    @Test
    public void with_unspecified_arguments(){
        Comparable c=mock(Comparable.class);
        when(c.compareTo(anyInt())).thenReturn(-1);
        assertEquals(-1,c.compareTo(5));
    }
</code></pre></div>
<p>这个<code>Comparable</code>的桩对象，不管我们传递任何参数，这个方法总是返回-1。如果你的方法是<code>void</code>型的，这个就有点讨巧了，因为你没法在when中传递这个方法。可以把之前的方式替换成<code>doReturn(result).when(mock_object).void_method_call();</code>。除了可以指定返回，你还可以使用<code>.thenThrow()</code>或者<code>doThrow()</code>。例如，</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">    @Test(expected=IOException.class)
    public void OutputStreamWriter_rethrows_an_exception_from_OutputStream() 
            throws IOException{
        OutputStream mock=mock(OutputStream.class);
        OutputStreamWriter osw=new OutputStreamWriter(mock);
        doThrow(new IOException()).when(mock).close();
        osw.close();
    }
</code></pre></div>
<p>这个例子中，当我们调用<code>OutputStream</code>的<code>close</code>方法时，会抛出<code>IOException</code>。我们简单地可以验证，<code>OutputStreamWriter</code>从包装的输出流（译者注，这边的包装对象使用到的是<a href="http://en.wikipedia.org/wiki/Decorator_pattern">装饰器模式</a>）中重新抛出了这个异常。为了验证相关对象实际的调用（特别被用于模拟对象），我们可以使用<code>verify(mock_object).method.call</code>。例如，</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">    @Test
    public void OutputStreamWriter_Closes_OutputStream_on_Close()
            throws IOException{
        OutputStream mock=mock(OutputStream.class);
        OutputStreamWriter osw=new OutputStreamWriter(mock);
        osw.close();
        verify(mock).close();
    }
</code></pre></div>
<p>这个例子将会验证当<code>OutputStreamWriter</code>被关闭时，是否同时关闭了包装的输出流。就和之前的那个例子一样，通过使用类似<code>anyInt()</code>的匹配器来匹配方法中的参数。这边要注意，你不能把文本参数（译者注：直接传递具体的参数值）和匹配器参数混合使用，所以如果你使用了多个参数，同时包含了文本参数或是匹配参数。使用<code>eq(value)</code>匹配器把文本参数转换为匹配参数来作比较。Mockito内建了许多匹配器，但是有时候你需要灵活使用。例如，<code>OutputStreamWriter</code>会对输出设置缓冲，直到倾倒缓冲的时候才会使用到包装的输出流对象，但是我们不知道究竟这个缓冲有多大，所以我们不能做等价的匹配。我们需要使用我们自己的匹配：</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">@Test
public void OutputStreamWriter_Buffers_And_Forwards_To_OutputStream() 
    throws IOException{     
    OutputStream mock=mock(OutputStream.class);
    OutputStreamWriter osw=new OutputStreamWriter(mock);
    osw.write(&#39;a&#39;);
    osw.flush();
    // can&#39;t do this as we don&#39;t know how long the array is going to be
    // verify(mock).write(new byte[]{&#39;a&#39;},0,1);

    BaseMatcher arrayStartingWithA=new BaseMatcher(){
        @Override
        public void describeTo(Description description) {
            // nothing
        }
        // check that first character is A
        @Override
        public boolean matches(Object item) {
            byte[] actual=(byte[]) item;
            return actual[0]==&#39;a&#39;;
        }
    };
    // check that first character of the array is A, and that the other two arguments are 0 and 1
    verify(mock).write(argThat(arrayStartingWithA), eq(0),eq(1));   
}
</code></pre></div>
<p>就说到这里，这些已经包含了你所需要了解的基础知识。现在开始深入学习，重构你那些丑陋的<a href="http://easymock.org/">easymock</a>代码吧。</p>

</article>

	  
      <div id="disqus_thread"></div>
      <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'predatorray'; // required: replace example with your forum shortname

          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

      <footer>
        <p>
          This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/deed.en_US">Creative Commons Attribution-NonCommercial 4.0 International License</a>.
        </p>
      </footer>
    </div>

    <!-- scripts -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="/public/js/jquery.fitvids.js"></script>
    <script src="/public/js/prettify.js"></script>
    <script>
      $(document).ready(function(){
        $("article").fitVids();
		$("pre").addClass("prettyprint");
		prettyPrint();
      });
    </script>
  </body>
</html>
